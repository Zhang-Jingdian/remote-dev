version: '3.8'

# ğŸš€ è¿œç¨‹å¼€å‘ç¯å¢ƒ - ç®€åŒ–Dockeré…ç½®
# ä½œè€…: Zhang-Jingdian (2157429750@qq.com)
# åˆ›å»ºæ—¶é—´: 2025å¹´7æœˆ14æ—¥

services:
  # ä¸»åº”ç”¨æœåŠ¡
  app:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: remote-dev-env
    ports:
      - "8080:8080" # WebæœåŠ¡ç«¯å£
      - "5001:5001" # APIæœåŠ¡ç«¯å£
    volumes:
      - ../main.py:/app/main.py
      - ../config.env:/app/config.env
      - ../logs:/app/logs
    working_dir: /app
    command: python main.py
    environment:
      - PYTHONUNBUFFERED=1
      - PORT=8080
      - API_PORT=5001
    restart: unless-stopped
    networks:
      - dev-network

  # Vue3 å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼ˆå¼€å‘æ—¶ä½¿ç”¨ï¼‰
  frontend:
    image: node:18-alpine
    container_name: remote-dev-frontend
    ports:
      - "3000:3000"
    volumes:
      - ../web:/app
    working_dir: /app
    command: sh -c "npm install && npm run dev"
    environment:
      - NODE_ENV=development
    depends_on:
      - app
    networks:
      - dev-network
    profiles:
      - dev # åªåœ¨å¼€å‘æ¨¡å¼ä¸‹å¯åŠ¨

networks:
  dev-network:
    driver: bridge

volumes:
  logs:
    driver: local
