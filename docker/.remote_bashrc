# 🚀 远程Docker开发环境专用 .bashrc
# 作者: Zhang-Jingdian
# 创建时间: 2025年7月15日

# ================================================================================================
# 基础设置
# ================================================================================================
export TERM=xterm-256color
export EDITOR=nano
export LANG=C.UTF-8
export PYTHONIOENCODING=utf-8

# 历史命令设置
export HISTSIZE=10000
export HISTFILESIZE=20000
export HISTCONTROL=ignoredups:erasedups
shopt -s histappend

# ================================================================================================
# 漂亮的提示符设置
# ================================================================================================
# 参考: https://www.thenetnerd.uk/2022/11/23/fancy-linux-command-prompt/
# 多行提示符，包含状态指示、用户、主机、路径

# 颜色定义
RED='\[\033[0;31m\]'
GREEN='\[\033[0;32m\]'
YELLOW='\[\033[0;33m\]'
BLUE='\[\033[0;34m\]'
PURPLE='\[\033[0;35m\]'
CYAN='\[\033[0;36m\]'
WHITE='\[\033[0;37m\]'
GRAY='\[\033[0;90m\]'
BOLD_RED='\[\033[1;31m\]'
BOLD_GREEN='\[\033[1;32m\]'
BOLD_YELLOW='\[\033[1;33m\]'
BOLD_BLUE='\[\033[1;34m\]'
BOLD_PURPLE='\[\033[1;35m\]'
BOLD_CYAN='\[\033[1;36m\]'
BOLD_WHITE='\[\033[1;37m\]'
NC='\[\033[0m\]' # No Color

# 多行提示符，带有命令执行状态指示
export PS1="${GRAY}┌─\$(if [[ \$? == 0 ]]; then echo \"[${BOLD_GREEN}✓${GRAY}]\"; else echo \"[${BOLD_RED}✗${GRAY}]\"; fi)─[${BOLD_CYAN}🐳 remote-dev${GRAY}]─[${BOLD_YELLOW}\u${GRAY}]─[${BOLD_BLUE}\w${GRAY}]\n└─${BOLD_GREEN}\$ ${NC}"

# 简单版本的提示符（如果上面的太复杂可以用这个）
# export PS1="${BOLD_CYAN}🐳 remote-dev${NC}:${BOLD_BLUE}\w${NC}\$ "

# ================================================================================================
# 有用的别名
# ================================================================================================
alias ll='ls -alF --color=auto'
alias la='ls -A --color=auto'
alias l='ls -CF --color=auto'
alias ls='ls --color=auto'
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# 目录导航
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'
alias .....='cd ../../../..'

# Python相关
alias python='python3'
alias pip='pip3'
alias py='python3'

# 常用操作
alias h='history'
alias c='clear'
alias e='nano'
alias tree='find . -type d -name ".*" -prune -o -print | sed -e "s;[^/]*/;|____;g;s;____|; |;g"'

# Git相关（如果安装了git）
alias gs='git status'
alias ga='git add'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline'

# Docker相关
alias dps='docker ps'
alias dpsa='docker ps -a'

# ================================================================================================
# 自定义函数
# ================================================================================================

# 快速查看文件内容
function peek() {
    if [ -f "$1" ]; then
        echo -e "${BOLD_CYAN}📄 文件内容: $1${NC}"
        echo -e "${GRAY}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
        head -20 "$1"
        if [ $(wc -l < "$1") -gt 20 ]; then
            echo -e "${GRAY}... (更多内容请使用 cat 或 less 查看)${NC}"
        fi
        echo -e "${GRAY}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    else
        echo -e "${BOLD_RED}❌ 文件不存在: $1${NC}"
    fi
}

# 快速创建并进入目录
function mkcd() {
    mkdir -p "$1" && cd "$1"
}

# 显示当前目录的文件树
function lstree() {
    find "${1:-.}" -type d -name ".*" -prune -o -print | head -50 | sed -e 's;[^/]*/;|____;g;s;____|; |;g'
}

# ================================================================================================
# 欢迎消息
# ================================================================================================
function show_welcome() {
    echo -e "${BOLD_PURPLE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
    echo -e "${BOLD_CYAN}🚀 欢迎进入远程Docker开发环境！${NC}"
    echo -e "${WHITE}📁 工作目录: ${BOLD_BLUE}$(pwd)${NC}"
    echo -e "${WHITE}🛠️  可用工具: ${BOLD_GREEN}python3, pip, git, nano, curl${NC}"
    echo -e "${WHITE}💡 提示: 你的本地代码已同步到此容器中${NC}"
    echo -e "${WHITE}📝 可用别名: ${BOLD_YELLOW}ll, la, py, h, c, e, gs, ga, gc${NC}"
    echo -e "${WHITE}🎯 自定义函数: ${BOLD_YELLOW}peek <file>, mkcd <dir>, lstree${NC}"
    echo -e "${BOLD_PURPLE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${NC}"
}

# 只在交互式shell中显示欢迎消息
if [[ $- == *i* ]]; then
    show_welcome
fi

# ================================================================================================
# 其他设置
# ================================================================================================

# 启用颜色提示
force_color_prompt=yes

# 使命令补全更智能
bind "set completion-ignore-case on"
bind "set show-all-if-ambiguous on"
bind "set menu-complete-display-prefix on"

# cd时自动ls
function cd() {
    builtin cd "$@" && ls -la --color=auto
} 