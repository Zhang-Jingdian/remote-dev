# ğŸš€ è¿œç¨‹å¼€å‘ç¯å¢ƒ - ç®€åŒ–Dockerfile
# ä½œè€…: Zhang-Jingdian (2157429750@qq.com)  
# åˆ›å»ºæ—¶é—´: 2025å¹´7æœˆ14æ—¥

FROM python:3.11-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    openssh-client \
    rsync \
    curl \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶å¹¶å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY src/ .
COPY config.env .

# åˆ›å»ºæ—¥å¿—ç›®å½•
RUN mkdir -p logs

# æš´éœ²ç«¯å£
EXPOSE 8080 5000

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:5000/api/health || exit 1

# å¯åŠ¨åº”ç”¨
CMD ["python", "main.py"] 